<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />

    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">

    <script src="/javascripts/jquery-3.2.0.min.js"></script>
    <script src="/javascripts/bootstrap.min.js"></script>
    <script>
        $(document).ready(function () {
            $('a.page_number').click(function (currentPage) {
                paging(currentPage);
            });
        });

        function paging(currentPageTemp) {
            var currentPage = Number(currentPageTemp);
            $('input[name="currentPage"]').val(currentPage);
            $.ajax({      
                type: 'GET',  
                url: '/users/paging',
                data: $('#pageData').serialize(),
                success: function (data) {
                    var txt = '';
                    for (var i = 0; i < data.result.length; i++) {
                        txt += '<tr>';
                        txt += '<td>' + data.result[i].sid + '</td>';
                        txt += '<td>' + data.result[i].user_number + '</td>';
                        txt += '<td>' + data.result[i].customer_comment + '</td>';
                        txt += '<td>' + data.result[i].channel + '</td>';
                        txt += '<td>' + data.result[i].response_time + '</td>';
                        txt += '<td>' + data.result[i].reg_date + '</td>';
                        txt += '<td><input type="button" value="삭제" onclick="deleteUser(' + data.result[i].sid + ')"/></td></tr>';

                    }
                    $('tbody').html('');
                    $('tbody').append(txt);                 

                    var pageNum = '';

                    if (data.currentPage > data.pageCount) {
                        pageNum += '<a href="#"> << </a>';
                    }
                    if (data.currentPage != 1) {
                        pageNum += '<a href="#" onclick="paging(' + (data.currentPage-1) + ');"> < </a>';
                    }
                    for (var i = data.startPage; i <= data.endPage; i++) {
                        if (data.currentPage == i) {
                            pageNum += '| <a class="page_number" style="color:red;">' + i + '</a> | ';
                        } else {
                            pageNum += '| <a class="page_number" href="#" onclick="paging(' + i + ');">' + i + '</a> | ';
                        }
                    }
                    if (data.currentPage != data.totPageCount) {
                        pageNum += '<a href="#" onclick="paging(' + (data.currentPage+1) + ');"> > </a>';
                    }
                    if (data.currentPage < (data.totPageCount - data.pageCount)) {
                        pageNum += '<a href="#"> >> </a>';
                    }
                    $('#paging').html('');
                    $('#paging').append(pageNum);
                    
                },
                error:function(e){
                }  
            });  
        };

        function deleteUser(sid) {
            if (confirm('삭제하시겠습니까?')) {
                $('input[name="deleteSid"]').val(sid);

                $.ajax({
                    type: 'GET',
                    url: '/users/delete',
                    data: $('#pageData').serialize(),
                    success: function (data) {
                        $('input[name="deleteSid"]').val('');
                        location.href = '/users';
                    },
                    error: function (e) {
                    }
                });
            }
        };
    </script>
    
    <title></title>
</head>
<body>
    <form id="pageData">
        <input type="hidden" name="currentPage" value="<%=currentPage%>"/>
        <input type="hidden" name="totPageCount" value="<%=totPageCount%>" />
        <input type="hidden" name="pageCount" value="<%=pageCount%>" />
        <input type="hidden" name="startPage" value="<%=startPage%>" />
        <input type="hidden" name="endPage" value="<%=endPage%>" />
        <input type="hidden" name="deleteSid" value="" />
    </form>

    <div style="height:20px;">

    </div>
    <table class="table" style="width: 80%; text-align:center;" align="center">
        <thead>
            <tr>
                <th style="text-align:center;">NO</th>
                <th style="text-align:center;">고유번호</th>
                <th style="text-align:center;">고객코맨트</th>
                <th style="text-align:center;">채널</th>
                <th style="text-align:center;">응답시간</th>
                <th style="text-align:center;">날짜</th>
                <th style="text-align:center;"></th>
            </tr>
        </thead>   
        <tbody>
            <% result.forEach(function(item,index){%>
            <tr>
                <td><%=item.sid%></td>
                <td><%=item.user_number%></td>
                <td><%=item.customer_comment%></td>
                <td><%=item.channel%></td>
                <td><%=item.response_time%></td>
                <td><%=item.reg_date%></td>
                <td>
                    <input type="button" value="삭제" onclick="deleteUser('<%=item.sid%>')"/>
                </td>
            </tr>
            <%});%>
        </tbody>
    </table>
    <div id="paging" style="text-align: center;">
        <%if(currentPage > pageCount){%>
        <a href="#"> << </a>
        <%}%>
        <%if(currentPage != 1){%>
        <a href="#" onclick="paging('<%=currentPage-1%>');"> < </a>     
        <%}%>   
        <%for(var i = startPage;i <= endPage;i++){%>
        <%if (currentPage == i) {%>
        | <a class="page_number" style="color:red;"><%=i%></a> |
        <%}else{%>
        | <a class="page_number" href="#" onclick="paging('<%=i%>');"><%=i%></a> |
        <%}%>
        <%}%>
        <%if(currentPage != totPageCount){%>
        <a href="#" onclick="paging('<%=currentPage+1%>');"> > </a>
        <%}%>
        <%if(currentPage < (totPageCount - pageCount)){%> 
        <a href="#"> >> </a>
        <%}%>
    </div>
</body>
</html>